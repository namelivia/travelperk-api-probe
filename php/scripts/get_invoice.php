<?php
require_once(__DIR__."/../vendor/autoload.php");
require_once("utils.php");
use Namelivia\TravelPerk\ServiceProvider;
$travelperk = (new ServiceProvider())->build(getenv("SANDBOX_API_KEY"), True);
$invoice = $travelperk->expenses()->invoices()->get("CR-01-2");
write_output("invoice", [
	$invoice->serialNumber,
	$invoice->profileId,
	$invoice->profileName,
	$invoice->billingInformation->legalName,
	$invoice->billingInformation->vatNumber,
	$invoice->billingInformation->addressLine1,
	$invoice->billingInformation->addressLine2,
	$invoice->billingInformation->city,
	$invoice->billingInformation->postalCode,
	$invoice->billingInformation->countryName,
	$invoice->mode,
	$invoice->status,
	$invoice->issuingDate,
	$invoice->billingPeriod,
	$invoice->fromDate,
	$invoice->toDate,
	$invoice->dueDate,
	$invoice->currency,
	$invoice->total,
	$invoice->taxesSummary,
	$invoice->reference,
	$invoice->travelperkBankAccount->bankName,
	$invoice->travelperkBankAccount->accountNumber,
	$invoice->travelperkBankAccount->bic,
	$invoice->travelperkBankAccount->reference,
	substr($invoice->pdf, 0, 40), # This link will change every time
	$invoice->lines->total,
	count($invoice->lines->data),
	$invoice->lines->data[0]->expenseDate,
	$invoice->lines->data[0]->description,
	$invoice->lines->data[0]->quantity,
	$invoice->lines->data[0]->unitPrice,
	$invoice->lines->data[0]->nonTaxableUnitPrice,
	$invoice->lines->data[0]->taxPercentage,
	$invoice->lines->data[0]->taxAmount,
	$invoice->lines->data[0]->taxRegime,
	$invoice->lines->data[0]->totalAmount,
	$invoice->lines->data[0]->metadata->tripId,
	$invoice->lines->data[0]->metadata->tripName,
	$invoice->lines->data[0]->metadata->service,
	count($invoice->lines->data[0]->metadata->travelers),
	$invoice->lines->data[0]->metadata->travelers[0]->name,
	$invoice->lines->data[0]->metadata->travelers[0]->email,
	$invoice->lines->data[0]->metadata->travelers[0]->externalId,
	$invoice->lines->data[0]->metadata->startDate,
	$invoice->lines->data[0]->metadata->endDate,
	$invoice->lines->data[0]->metadata->costCenter,
	count($invoice->lines->data[0]->metadata->labels),
	$invoice->lines->data[0]->metadata->labels[0],
	$invoice->lines->data[0]->metadata->vendor->code,
	$invoice->lines->data[0]->metadata->vendor->name,
	$invoice->lines->data[0]->metadata->outOfPolicy,
	$invoice->lines->data[0]->metadata->approvers,
	$invoice->lines->data[0]->metadata->booker->name,
	$invoice->lines->data[0]->metadata->booker->email,
	$invoice->lines->data[0]->metadata->booker->externalId,
]);
